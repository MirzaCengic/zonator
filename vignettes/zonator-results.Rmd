<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Create zonator project based on existing data}
-->

```{r setup, echo=FALSE}
options(width=160)
```

## Exploring results

First, let's set up the scene.

```{r setup-objects, message=FALSE}
library(zonator)

# Start by creating a project using the tutorial data
setup.dir <- system.file("extdata/tutorial/basic", package="zonator") 
tutorial.project <- create_zproject(setup.dir)

# Get a specific variant
variant.caz <- get_variant(tutorial.project, "01_core_area_zonation")

# Let's also rename the features and groups while we're at it
featurenames(variant.caz) <- c("Koala", "Masked.owl", "Powerful.owl", 
                             "Tiger.quoll", "Sooty.owl", "Squirrel.glider",
                             "Yellow-bellied.glider")
labels <- c("mammals", "owls")
names(labels) <- c(1, 2)
groupnames(variant.caz) <- labels
```

Each variant can either already have results (i.e. Zonation run has completed) 
or then not. Which results exactly are available can be determined by using 
method `has_results()`.

```{r has-results, message=FALSE} 
has_results(variant.caz)
```

Value `TRUE` indicates that Zonation has already been run and results are 
available and `FALSE` indicates that results are not available. For the tutorial
data used here, all the results are available.

Results of a given variant can be extracted using `results()`.

```{r get-results}
results.caz <- results(variant.caz)
```

### Working with performance results (curves)

Raw curves data (with or without groups) can be extracted from results using 
`curves()`. Optional argument `groups` defines whether feature or group specific
curves are returned. If you don't need every feature or aggregate statistic,
you can also get the data for particular features.


```{r curves}
# Get feature-specific curves
feature.curves <- curves(results.caz)
head(feature.curves)

# Get just 2 species
duo.curves <- curves(results.caz, cols=c("Koala", "Tiger.quoll"))
head(duo.curves)
```

Columns are exaclty the same as in Zonation curves output file. Note also that 
the actual feature columns are named according to feature names in the 
`Zvariant` object these results were derived from. Thus whatever names you 
assigned to features prior to extracting the results will be also seen here.

Let's see  what the group curves data looks like as a whole or for individual 
groups:

```{r grp-curves}
# Get group-specific curves
feature.grp.curves <- curves(results.caz, groups=TRUE)
head(feature.grp.curves)

# Get all the aggregate stats for owls
owls.grp.curves <- curves(results.caz, groups=TRUE, 
                          cols=c("min.owls", "mean.owls", "max.owls",
                                 "w.mean.owls", "ext2.owls"))
head(owls.grp.curves)
```

Often a particular range of cell removal process is more interesting than the 
whole range. `curves()` has arguments `lost.lower` and `lost.upper` to define 
a specific range:

```{r curves-range}

# Get performance values for 2 species for a range between 60% and 75% of 
# landscape lost 
duo.curves.range <- curves(results.caz, cols=c("Koala", "Tiger.quoll"),
                           lost.lower=0.6, lost.upper=0.75)
head(duo.curves.range)
tail(duo.curves.range)
```

Sometimes you might also be interested in performance values of features at 
specific levels of landscape protection. For example, how much of the original
occurence levels are remaining when 25%, 50%, and 75% of landscape is lost.
Method `performance()` can give you exactly this information.

```{r perfomance}
# Define the levels of landscape lost
lost.levels <- c(0.25, 0.50, 0.75)
# Notice that performance operates with Zresults-object
performance(results.caz, lost.levels)

# Same can be done for groups
performance(results.caz, lost.levels, groups=TRUE)
```

**Pro tip!** If you're a heavy user of Hadley Wickham's excellent 
[ggplot2](http://ggplot2.org/) package you might a lot of time 
[reshaping](http://www.statmethods.net/management/reshape.html) your data. 
Method `performance()` also has an optional argument `melted` which if set TRUE 
will make the method return performance data in a melted format and thus readily 
suitable for ggplot2-plotting (see below for a plotting example).

```{r perfomance-melted}
# Define the levels of landscape lost
lost.levels <- c(0.25, 0.50, 0.75)
# Notice that performance operates with Zresults-object
performance(results.caz, lost.levels, melted=TRUE)
```

### Plotting performance curves

Performance data (curves) can also be easily plotted, feature- or group-wise.

```{r curves-plotting, fig.width=10}
plot(feature.curves, invert.x=TRUE, main="All features")
plot(duo.curves, invert.x=TRUE, main="Just few features")
```

### Plotting performance levels

If you want to summarize how much each feature has retained it's occurrence 
level in a given stage of the cell removal process, you can easily created 
bar plots out of selected performance levels. For example, if you'd like to 
know how much of the original occurrenve level each of species in our tutorial 
data has left when 10% percent of the landscape is under conservation, you 
could do the following:

```{r perfomance-hist, fig.width=10}
# NOTE: we're using melted=TRUE here
occr.remaining <- performance(results.caz, c(0.9, 0.95, 0.98), melted=TRUE)
ggplot(occr.remaining, aes(x = factor(feature), y = perf.levels,
                           fill=factor(pr.lost))) + 
  geom_bar(position="dodge", stat = "identity")

```


